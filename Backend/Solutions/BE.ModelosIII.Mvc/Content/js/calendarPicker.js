jQuery.fn.calendarPicker=function(d){if(!d.date){d.date=new Date()}if(typeof(d.years)=="undefined"){d.years=1}if(typeof(d.months)=="undefined"){d.months=3}if(typeof(d.days)=="undefined"){d.days=4}if(typeof(d.showDayArrows)=="undefined"){d.showDayArrows=true}if(typeof(d.useWheel)=="undefined"){d.useWheel=true}if(typeof(d.callbackDelay)=="undefined"){d.callbackDelay=500}if(typeof(d.monthNames)=="undefined"){d.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}if(typeof(d.dayNames)=="undefined"){d.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}var f={currentDate:d.date};f.options=d;var e=this.eq(0);e.addClass("calBox");e.empty();var a=$("<div>").addClass("calYear");var c=$("<div>").addClass("calMonth");var b=$("<div>").addClass("calDay");e.append(a).append(c).append(b);f.changeDate=function(i){f.currentDate=i;var g=function(m){var q=m.getFullYear();var o=new Date();a.empty();var s=d.years*2+1;var l=parseInt((80/s))+"%";console.log(l);for(var n=q-d.years;n<=q+d.years;n++){var r=new Date(m);r.setFullYear(n);var p=$("<span>").addClass("calElement").attr("millis",r.getTime()).html(n).css("width",l);if(r.getYear()==o.getYear()){p.addClass("today")}if(r.getYear()==f.currentDate.getYear()){p.addClass("selected")}a.append(p)}};var k=function(l){var p=l.getMonth();var u=new Date();c.empty();var m=l.getDay();var n=d.months*2+1;var s=parseInt((80)/n)+"%";for(var o=-d.months;o<=d.months;o++){var q=new Date(l);var m=q.getDate();q.setMonth(p+o);if(q.getDate()!=m){q.setMonth(q.getMonth()-1);q.setDate(28)}var r=$("<span>").addClass("calElement").attr("millis",q.getTime()).html(d.monthNames[q.getMonth()]).css("width",s);if(q.getYear()==u.getYear()&&q.getMonth()==u.getMonth()){r.addClass("today")}if(q.getYear()==f.currentDate.getYear()&&q.getMonth()==f.currentDate.getMonth()){r.addClass("selected")}c.append(r)}};var j=function(n){var m=n.getDate();var p=new Date();b.empty();var s=d.days*2+1;var l=parseInt((90)/(s-(d.showDayArrows?2:0)))+"%";for(var o=-d.days;o<=d.days;o++){var r=new Date(n);r.setDate(m+o);var q=$("<span>").addClass("calElement").attr("millis",r.getTime());if(o==-d.days&&d.showDayArrows){q.addClass("prev")}else{if(o==d.days&&d.showDayArrows){q.addClass("next")}else{q.html("<span class=dayNumber>"+r.getDate()+"</span><br>"+d.dayNames[r.getDay()]).css("width",l);if(r.getYear()==p.getYear()&&r.getMonth()==p.getMonth()&&r.getDate()==p.getDate()){q.addClass("today")}if(r.getYear()==f.currentDate.getYear()&&r.getMonth()==f.currentDate.getMonth()&&r.getDate()==f.currentDate.getDate()){q.addClass("selected")}}}b.append(q)}};var h=function(){if(typeof(d.callback)=="function"){if(f.timer){clearTimeout(f.timer)}f.timer=setTimeout(function(){d.callback(f)},d.callbackDelay)}};g(i);k(i);j(i);h()};e.click(function(h){var g=$(h.target).closest(".calElement");if(g.hasClass("calElement")){f.changeDate(new Date(parseInt(g.attr("millis"))))}});if($.event.special.mousewheel&&d.useWheel){a.mousewheel(function(g,i){var h=new Date(f.currentDate.getTime());h.setFullYear(h.getFullYear()+i);f.changeDate(h);return false});c.mousewheel(function(g,i){var h=new Date(f.currentDate.getTime());h.setMonth(h.getMonth()+i);f.changeDate(h);return false});b.mousewheel(function(g,i){var h=new Date(f.currentDate.getTime());h.setDate(h.getDate()+i);f.changeDate(h);return false})}f.changeDate(d.date);return f};